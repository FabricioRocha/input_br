05 REM Planilha eletrônica (1) - Input vol 4, pg 213 (p. 1108)

10 KEYOFF:CLEAR 10000:COLOR 15,4,4:SCREEN 0:CLS:LOCATE 9,11:PRINT"PLANILHA ELETRÔNICA"
20 CS=1:RS=1:CR=1:CC=1:MO$(0)="VALOR(CALC) ":MO$(1)="EQUAÇÃO: ":MO=1:OP$="+-*/%$&"
30 DIM D$(26,30),D(26,30)
40 FOR I=1 TO 26:FOR J=1 TO 30:D$(I,J)=CHR$(128): NEXT J,I
50 CX=4:RX=1
60 GOSUB 70:GOTO 170

70 CLS:LOCATE 0,20:PRINT"AGUARDE...":LOCATE0,0:PRINTSTRING$(3,219);:FOR I=CS TO CS+4:PRINTCHR$(91);SPC(2);CHR$(93);:NEXT:PRINTCHR$(219);
80 LOCATE 0,21:PRINT"MODO: ";MO$(MO)
90 FOR I=0 TO 15:C1=INT((RS+I)/10)+48:C2=(RS+I)-((C1-48)*10)+48:LOCATE 0,I+1:PRINTCHR$(C1);CHR$(C2):NEXT
100 LOCATE 19,0:IF MO=0 THEN GOSUB 740:GOTO 130
110 FOR J=RS TO RS+15:FOR I=CS TO CS+4
120 LOCATE (I-CS)*7+3,J-RS+1:GOSUB 660:NEXT I,J
130 LOCATE 0,21:PRINT"MODO: ";MO$(MO);TAB(20)"CEL: ";CHR$(64+CC);MID$(STR$(CR);"  ";
140 LOCATE 0,20:PRINT"PRONTO! ";TAB(15)MID$(D$(CC,CR),2);SPC(9)
160 RETURN

170 PS=(CR-RS+1)*40+(CC-CS)*7+4:Z=VPEEK(PS):VPOKE PS,219
180 I$=INKEY$:IF I$="" THEN 180
190 VPOKE PS,Z
200 IF I$=CHR$(29) AND CC>1 THEN CC=CC-1:IF CC>CS THEN CS=CS-1:GOSUB 70
210 IF I$=CHR$(28) AND CC>26 THEN CC=CC+1:IF CC>CS+4 THEN CS=CS+1:GOSUB 70
220 IF I$=CHR$(31) AND CR<30 THEN CR=CR+1:IF CR>RS+15 THEN RS=RS+1:GOSUB 70
230 IF I$=CHR$(30) AND CR>1 THEN CR=CR-1:IF CR<RS THEN RS=RS-1:GOSUB 70
240 IF I$="G" THEN GOSUB 330
250 IF I$="Q" THEN CLS:INPUT"TERMINO O PROGRAMA? (S/N) ";A$:IF A$<>"S" THEN GOSUB 70 ELSE CLS:END
260 IF I$="I" THEN GOSUB 410
270 IF I$="V" THEN MO=0:GOSUB 70
280 IF I$="C" THEN GOSUB 1490
290 IF I$="E" THEN MO=1:GOSUB 70
300 IF I$="S" THEN GOSUB 1230
310 IF I$="L" THEN GOSUB 1350
320 GOSUB 130:GOTO 170
330 LOCATE 0,20:PRINTSPC(38):LOCATE 0,20:PRINT"PARA CEL >";INPUT A$
340 IF A$="" THEN RETURN
350 C1=ASC(A$)-64:IF C1<1 OR C1>26 THEN 330
360 C2=VAL(MID$(A$,2)):IF C2<1 OR C2>26 THEN 330
370 CC=C1:CS=C1:CR=C2:RS=C2
380 IF CS>23 THEN CS=23
390 IF RS>19 THEN RS=19
400 GOSUB 70:RETURN

410 LOCATE 0,20:PRINT"NOVO CONTEÚDO: ";SPC(22);:LOCATE 15:LINE INPUT A$
420 IF A$="" THEN A$=CHR$(128):GOTO 610
430 IF LEN(A$)>9 THEN LOCATE 0,20:PRINT"ENTRADA INVÁLIDA ":FOR I=1 TO 500:NEXT:GOTO 410
440 IF VAL(A$)<>0 THEN 560
450 B$=LEFT$(A$,1):IF B$<"A" OR B$>"Z" THEN 600
460 C$=MID$(A$,2,2)
470 IF VAL(C$)<1 OR VAL(C$)>30 THEN 600
480 IF VAL(C$)<10 THEN A$=B$+STR$(VAL(C$))+MID$(A$,3)
490 D$=MID$(A$,4,1):IF D$<"A" OR D$>"Z" THEN 600
500 E$=MID$(A$,5)
510 IF VAL(E$)<1 OR VAL(E$)>30 THEN 600
520 IF VAL(E$)<10 THEN A$=LEFT$(A$,4)+STR$(VAL(E$))+MID$(A$,6)
530 O$=MID$(A$,7,1):IF(INSTR(1,OP$,O$)=0 OR O$="" THEN 600
540 DP=VAL(RIGHT$(A$,1)):IF DP<0 OR DP>7 THEN 600
550 LOCATE 0,20:PRINT"A entrada é uma EQUAÇÃO":A$=CHR$(131)+A$:GOTO 610
560 LOCATE 0,20:PRINT"A entrada é um VALOR"
570 IF RIGHT$(A$,1)=" " THEN A$=LEFT$(A$,LEN(A$)-1):GOTO 570
580 IF LEN(A$)<7 THEN A$=" "+A$:GOTO 580
590 A$=CHR$(129)+A$:GOTO 610
600 LOCATE 0,20:PRINT"A entrada é um RÓTULO":A$=CHR$(130)+A$
610 D$(CC,CR)=A$:I=CC:J=CR:LOCATE (I-CS)*7+3, (J-RS)+1:GOSUB 660
620 IF CC>CX THEN CX=CC
630 IF CR>RX THEN RX=CR
640 IF MO=0 THEN MO=1:GOSUB 70
650 RETURN

654 ========================================================
655 REM PLANILHA ELETRONICA (2): INPUT VOL 4 PG 237 (P 1134)

660 A$=D$(I,J):B$=MID$(A$,2)
670 AT=ASC(A$)
680 IF AT=128 THEN PRINTSTRING(7,32);:GOTO 720
690 IF AT=129 OR AT=130 THEN PRINTUSING"\     \";B$;:GOTO 720
700 FOR U=1 TO LEN(B$):IF MID$(B$,U,1)<>CHR$(32)THEN PRINT MID$(B$,U,1);
710 NEXT U
720 RETURN
730 C1=ASC(Z$)-64:C2=VAL(MID$(Z$,2)):V=D(C1,C2):RETURN
740 LOCATE 0,20:PRINT"TRABALHANDO...";SPC(24)
750 FOR J=1 TO RX
760 FOR I=1 TO CX
770 D(I,J)=0:IF ASC(D$(I,J))=129 THEN D(I,J)=VAL(MID$(D$(I,J),2))
780 NEXT I,J
790 FOR J=1 TO RX
800 FOR I=1 TO CX
810 LOCATE 0,20:PRINT"TRABALHANDO NA CEL ";CHR$(I+64);MID$(STR$(J),2)
820 IF ASC(D$(I,J))<>131 THEN 1130
830 A$=MID$(D$(I,J),2)
840 O$=MID$(A$,7,1)
850 IF O$="&" THEN 1050
860 IF O$="$" THEN 1090
870 Z$=LEFT$(A$,3)
880 GOSUB 730

890 V1=V:Z$=MID$(A$,4,3):GOSUB 730:V2=V
900 DP=VAL(RIGHT$(A$,1))
910 ON INSTR(1,OP$,O$) GOSUB 1000,1010,1020,1030,1040
920 OV=0:IF DP=0 THEN PU$="#######":MP=7:GOTO 950
930 PU$=STRING$(7-(DP+1),"#")+" "+STRING$(DP,"#"):MP=7-(DP+1)
940 IF LEN(PU$)>7 THEN RV$="  <OV>":OV=1
950 D(I,J)=RV
960 IF RV<0 THEN MP=MP-1
970 ML=LEN(MID$(STR$(INT(RV+.5)),2))
980 IF ML>MP THEN RV$="  <OV>":OV=1
990 GOTO 1160

1000 RV=V1+V2:RETURN
1010 RV=V1-V2:RETURN
1020 RV=V1*V2:RETURN
1030 IF V2=0 THEN RV=0:RETURN ELSE RV=V1/V2:RETURN
1040 RV=V1*V2/100:RETURN
1050 P1=ASC(A$)-64:P2=ASC(MID$(A$,2,2)):RV=0
1060 FOR C1=P1 TO P2
1070 RV=RV+D(C1,C2):NEXT
1080 DP=VAL(RIGHT$(A$,1)):GOTO 920
1090 P1=VAL(MID$(A$,2,2)):P2=VAL(MID$(A$,5,2)):C1=ASC(A$)-64:RV=0
1100 FOR C2=P1 TO P2
1110 RV=RV+D(C1,C2):NEXT
1120 DP=VAL(RIGHT$(A$,1)):GOTO 920
1130 IF ASC(D$(I,J))<>128 THEN 1150
1140 RV$=STRING$(7,32):GOTO 1160
1150 RV$=MID$(D$(I,J),2)
1160 IF I>=CS AND I<=CS+4 AND J>=RS AND J<=15 THEN LOCATE (I-CS)*7+3, (J-RS)+1:PF=1 ELSE PF=0
1170 IF (ASC(D$(I,J))>=128 AND ASC(D$(I,J))<=130 OR OV=1 THEN 1200
1180 IF PF=1 THEN PRINTUSING PU$;RV;
1190 GOTO 1210
1200 IF PF=1 THEN PRINTUSING"\     \";RV$;
1210 NEXT I,J
1220 RETURN

1230 CLS:INPUT"QUER GRAVAR ESTA FOLHA? (S/N) ";A$
1240 IF A$<>"S" THEN 1340
1250 LINEINPUT "NOME DO ARQUIVO: ";F$
1260 F$="CAS:"+F$:OPEN F$ FOR OUTPUT AS #1
1270 FOR J=1 TO RX
1280 FOR I=1 TO CX
1290 IF ASC(D$(I,J))=128 THEN 1320
1300 Z$=D$(I,J):MID$(Z$,1,1)=CHR$(ASC(MID$(Z$,1,1))-90)
1310 PRINT #1,STR$(I);",";STR$(J):PRINT#1,Z$
1320 NEXT I,J
1330 CLOSE #1
1340 CLS:MO=1:GOSUB 70:RETURN

1350 CLS:INPUT"QUER CARREGAR UMA FOLHA DA FITA?"       (NOTE QUE A FOLHA DA MEMÓRIA SERÁ COMBINADA COM A NOVA) ";A$
1360 IF A$<>"S" THEN 1480
1380 LINEINPUT "NOME DO ARQUIVO: ";F$
1390 F$="CAS:"+F$:OPEN F$ FOR INPUT AS #1
1400 IF EOF(1) THEN 1470
1410 INPUT #1,A$,B$:LINEINPUT #1,C$
1420 MID$(C$,1,1)=CHR$(ASC(MID$(C$,1,1))+90)
1430 C1=VAL(A$):C2=VAL(B$):D$(C1,C2)=C$
1440 IF C1>CX THEN CX=C1
1450 IF C2>RX THEN RX=C2
1460 GOTO 1400
1470 CLOSE #1
1480 CLS:CC=1:CR=1:CS=1:RS=1:MO=1:GOSUB 70:RETURN

1484 ========================================================
1485 REM PLANILHA ELETRONICA (3): INPUT VOL 4 PG 264 (P 1159)

1490 LOCATE 0,21:PRINTSPC(35):LOCATE 0,21:IF LEN(D$(CC,CR))=1 THEN PRINT "NADA PARA COPIAR":FOR K=1 TO 500:NEXT:RETURN ELSE PRINT "CÓPIA <A>BSOLUTA OU <R>ELATIVA: ";
1500 A$=INKEY($):IF A$="" THEN 1500
1510 IF A$=CHR$(13) THEN RETURN
1520 IF A$="A" THEN TC=1:GOTO 1540
1530 IF A$<>"R" THEN 1490 ELSE TC=0
1540 LOCATE 0,21:PRINTSPC(35):LOCATE 0,21
1550 IF TC=0 AND ASC(D$(CC,CR))<>131 THEN PRINT"MODO DE CÓPIA ERRADO - SÓ EQUAÇÕES!";:FOR D=1 TO 500:NEXT:GOTO 490
1560 LOCATE 0,21:PRINT"CÓPIA POR <LINHA> OU <COLUNA>:    ";
1570 A$=INKEY$:IF A$="" THEN 1570
1580 IF A$=CHR$(13) THEN RETURN
1590 IF A$="C" THEN DC=1:GOTO 1610
1600 IF A$<>"L" THEN 1570 ELSE DC=0
1610 LOCATE 0,21:PRINTSPC(37):LOCATE 0,21:PRINT"INICIA NA CÉLULA";:INPUT A$:IF A$="" THEN RETURN
1620 S1=ASC(A$)-64:IF S1<1 OR S1>25 THEN 1610
1630 S2=VAL(MID$<A$,2)):IF S2<1 OR S2>30 THEN 1610
1640 LOCATE 0,21:PRINTSPC(37):LOCATE 0,21:PRINT"TERMINA NA CÉLULA";:INPUT A$
1650 IF A$="" THEN RETURN
1660 C1=ASC(A$)-64:IF C1<1 OR C1>25 THEN 1640
1670 C2=VAL(MID$(A$,2)):IF C2<1 OR C2>30 THEN 1640
1680 LOCATE 0,21:PRINTSPC(35):LOCATE 0,21:PRINT"COPIANDO... AGUARDE"
1690 IF TC=1 THEN 1970
1700 IF DC=1 THEN 1840
1710 IF C2<>S2 THEN 2090
1720 AW=ASC(MID$(D$(CC,CR),2))-64:IF AW<>26 AND AW+C1-S1>25 THEN C1=25+S1-AW
1730 AW=ASC(MID$(D$(CC,CR),5))-64:IF AW<>26 AND AW+C1-S1>25 THEN C1=25+S1-AW
1740 D$(S1,S2)=D$(CC,CR)
1750 FOR I=S1+1 TO C1
1760 A$=D$(I-1,S2)
1770 IF MID$(A$,2,1)="Z" THEN 1790
1780 MID$(A$,2,1)=CHR$(ASC(MID$(A$,2,1))+1)
1790 IF MID$(A$,5,1)="Z" THEN 1810
1800 MID$(A$,5,1)=CHR$(ASC(MID$(A$,5,1))+1)
1810 D$(I,S2)=A$:NEXT
1820 IF C1>CX THEN CX=C1
1830 GOTO 2080
1840 IF C1<>S1 THEN 2090
1850 AW=VAL(MID$(D$(CC,CR),3,2)):IF AW+C2-S2>30 THEN C2=30+S2-AW
1860 AW=VAL(MID$(D$(CC,CR),6)):IF AW+C2-S2>30 THEN C2=30+S2-AW
1870 D$(S1,S2)=D$(CC,CR)
1880 FOR I=S2+1 TO C2
1890 A$=D$(S1,I-1)
1900 IF MID$(A$,2,1)="Z" THEN 1920
1910 V=VAL(MID$(A$,3,2))+1:IF V<10 THEN MID$(A$,3,2)=STR$(V) ELSE MID$(A$,3,2)=MID$(STR$(V),2,2)
1920 IF MID$(A$,5,1)="Z" THEN 1940
1930 V=VAL(MID$(A$,6,2))+1:IF V<10 THEN MID$(A$,6,2)=STR$(V) ELSE MID$(A$,6,2)=MID$(STR$(V),2,2)
1940 D$(S1,I)=A$:NEXT
1950 IF C2>RX THEN RX=C2
1960 GOTO 2080
1970 IF DC=1 THEN 2030
1980 IF C2<>CR THEN 2090
1990 FOR I=CC+1 TO C1
2000 D$(I,CR)=D$(I-1,CR):NEXT
2010 IF C1>CX THEN CX=C1
2020 GOTO 2080

2030 IF C1<>CC THEN 2090
2040 FOR I=CR+1 TO C2
2050 D$(CC,I)=D$(CC,I-1):NEXT
2060 IF C2>RX THEN RX=C2
2070 GOTO 2080

2080 MO=1:GOSUB 70:RETURN

2090 LOCATE 0,21:PRINTSPC(35):LOCATE 0,21:PRINT"ERRO NA DESTINAÇÃO":FOR D=1 TO 500:NEXTD

2100 GOTO 2080
